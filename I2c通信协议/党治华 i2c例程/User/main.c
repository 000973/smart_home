#include "stm32f10x.h" // Device header

int main(void){
	while(1){
	#include "stm32f10x.h"                  // Device header
#include "Delay.h"

#define i2c_Port GPIOB			// i2c???GPIO??
#define i2c_SCL GPIO_Pin_10		// SCL?????
#define i2c_SDA GPIO_Pin_11		// SDA?????


void i2c_W_SCL(uint8_t state)
{
	// BitAction:???1?0???Bit_SET?Bit_RESET
	GPIO_WriteBit(i2c_Port, i2c_SCL, (BitAction)state);
	Delay_us(10);	// ?????????,???????
}
void i2c_W_SDA(uint8_t state)
{
	// BitAction:???1?0???Bit_SET?Bit_RESET
	GPIO_WriteBit(i2c_Port, i2c_SDA, (BitAction)state);
	Delay_us(10);	// ?????????,???????
}
uint8_t i2c_R_SDA()
{
	uint8_t BitVale = GPIO_ReadInputDataBit(i2c_Port, i2c_SDA);
	Delay_us(10);
	return BitVale;
}

void i2c_Init()
{
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	
	GPIO_InitTypeDef GPIO_InitStruct;
	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_OD;	// ????,i2c?????????,?????1
	GPIO_InitStruct.GPIO_Pin = i2c_SCL | i2c_SDA;
	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(i2c_Port, &GPIO_InitStruct);
}


void i2c_Start()
{
	i2c_W_SDA(1);
	i2c_W_SCL(1);
	i2c_W_SDA(0);
	i2c_W_SCL(0);
}

// ????
void i2c_End()
{
	i2c_W_SDA(0);
	i2c_W_SCL(1);
	i2c_W_SDA(1);
}

// ????????
void i2c_Write_Byte(uint8_t Byte)
{
	for(uint8_t i = 0; i < 8; i++)
	{
		i2c_W_SDA(Byte & (0x80 >> i));
		i2c_W_SCL(1);
		i2c_W_SCL(0);
	}
}

// ????????
uint8_t i2c_Read_Byte()
{
	uint8_t Byte = 0x00;
	i2c_W_SDA(1);
	for(uint8_t i = 0;i < 8; i++)
	{
		i2c_W_SCL(1);
		if(i2c_R_SDA() == 1){Byte |= (0x80 >> i);}
		i2c_W_SCL(0);
	}
	return Byte;
}

// ????
uint8_t i2c_Read_ACK()
{
	i2c_W_SDA(1);
	i2c_W_SCL(1);
	uint8_t ACK = i2c_R_SDA();
	i2c_W_SCL(0);
	return ACK;
}

// ????
void i2c_Write_ACK(uint8_t ACK)
{
	i2c_W_SDA(ACK);
	i2c_W_SCL(1);
	i2c_W_SCL(0);
}

i2c.h
#ifndef __i2c_H
#define __i2c_H

// ?????i2c???GPIO?
void i2c_Init(void);
// ????
void i2c_Start(void);
// ????
void i2c_End(void);
// ????????
uint8_t i2c_Read_Byte(void);
// ????????
void i2c_Write_Byte(uint8_t Byte);
// ????
uint8_t i2c_Read_ACK(void);
// ????
void i2c_Write_ACK(uint8_t ACK);

#endif

??MPU6050.c
#include "stm32f10x.h"                  // Device header
#include "MPU6050_Reg.h"
#include "i2c.h"

#define MPU_Addr 0xD0

/**
  * ?    ?:?????????????
  * ?    ?:Reg_Addr ?????
  * ?    ?:Byte ??????
  * ? ? ?:?
  */
void MPU6050_Write_Reg(uint8_t Reg_Addr, uint8_t Byte)
{
	i2c_Start();				// ????
	i2c_Write_Byte(MPU_Addr);	// MPU???
	i2c_Read_ACK();				// ????
	i2c_Write_Byte(Reg_Addr);	// MPU?????
	i2c_Read_ACK();				// ????
	i2c_Write_Byte(Byte);		// ????
	i2c_Read_ACK();				// ????
	i2c_End();					// ????
}

/**
  * ?    ?:????????????????
  * ?    ?:Reg_Addr ?????
  * ? ? ?:??????????(0~255)
  */
uint8_t MPU6050_Read_Reg(uint8_t Reg_Addr)
{
	uint8_t Data;						// ???????
	
	i2c_Start();						// ????
	i2c_Write_Byte(MPU_Addr);			// MPU???
	i2c_Read_ACK();						// ????
	i2c_Write_Byte(Reg_Addr);			// MPU?????
	i2c_Read_ACK();						// ????
	
	i2c_Start();						// ????
	i2c_Write_Byte(MPU_Addr | 0x01);	// MPU???
	i2c_Read_ACK();						// ????
	Data = i2c_Read_Byte();				// ?????
	i2c_Write_ACK(1);					// ???????
	i2c_End();							// ????
	
	return Data;
}

// ???????????0~7???:X?Y?Z?????????X?Y?Z?????
int16_t MPU6050_Data[7];

int16_t *MPU6050_Read_ALL_Data()
{
	// MPU6050?????????????,??7???????,?14??????
	uint16_t Byte[14];
	
	i2c_Start();							// ????
	i2c_Write_Byte(MPU_Addr);				// ????,???
	i2c_Read_ACK();							// ????
	i2c_Write_Byte(MPU6050_ACCEL_XOUT_H);	// ???????????,??????,???????????
	i2c_Read_ACK();							// ????
	
	i2c_Start();							// ????
	i2c_Write_Byte(MPU_Addr | 0x01);		// ????,???
	i2c_Read_ACK();							// ????
	
	// ????14?????????,??????????Byte???
	for(uint8_t i = 0; i < 14; i++)
	{
		Byte[i] = i2c_Read_Byte();			// ?????
		if(i == 13){i2c_Write_ACK(1);}		// ????14?????????,????????
		else{i2c_Write_ACK(0);}				// ?14????????????????????,????????
	}
	
	i2c_End();								// ????
	
	// ??8?????8??????????MPU6050???????
	for(uint8_t i = 0; i < 7; i++)
	{
		// ?????????????,???????????
		MPU6050_Data[i] = (int16_t)(Byte[i*2] << 8) | (Byte[i*2+1]);
	}
	return MPU6050_Data;
}

void MPU6050_Init()
{
	i2c_Init();
	
	/*MPU6050??????,????MPU6050??????????,??????????????*/
	MPU6050_Write_Reg(MPU6050_PWR_MGMT_1, 0x01);		//???????1,??????,??????X????
	MPU6050_Write_Reg(MPU6050_PWR_MGMT_2, 0x00);		//???????2,?????0,???????
	MPU6050_Write_Reg(MPU6050_SMPLRT_DIV, 0x09);		//????????,?????
	MPU6050_Write_Reg(MPU6050_CONFIG, 0x06);			//?????,??DLPF
	MPU6050_Write_Reg(MPU6050_GYRO_CONFIG, 0x18);		//????????,??????±2000°/s
	MPU6050_Write_Reg(MPU6050_ACCEL_CONFIG, 0x18);		//?????????,??????±16g
}
MPU6050_Reg.h
MPU6050??????

#ifndef __MPU6050_REG_H
#define __MPU6050_REG_H

#define	MPU6050_SMPLRT_DIV		0x19	// ???????
#define	MPU6050_CONFIG			0x1A	// ?????
#define	MPU6050_GYRO_CONFIG		0x1B	// ????????
#define	MPU6050_ACCEL_CONFIG	0x1C	// ?????????

#define	MPU6050_ACCEL_XOUT_H	0x3B	// X??????8???
#define	MPU6050_ACCEL_XOUT_L	0x3C	// X??????8???
#define	MPU6050_ACCEL_YOUT_H	0x3D	// Y??????8???
#define	MPU6050_ACCEL_YOUT_L	0x3E	// Y??????8???
#define	MPU6050_ACCEL_ZOUT_H	0x3F	// Z??????8???
#define	MPU6050_ACCEL_ZOUT_L	0x40	// Z??????8???
#define	MPU6050_TEMP_OUT_H		0x41	// ??????8???
#define	MPU6050_TEMP_OUT_L		0x42	// ??????8???
#define	MPU6050_GYRO_XOUT_H		0x43	// X??????8???
#define	MPU6050_GYRO_XOUT_L		0x44	// X??????8???
#define	MPU6050_GYRO_YOUT_H		0x45	// Y??????8???
#define	MPU6050_GYRO_YOUT_L		0x46	// Y??????8???
#define	MPU6050_GYRO_ZOUT_H		0x47	// Z??????8???
#define	MPU6050_GYRO_ZOUT_L		0x48	// Z??????8???

#define	MPU6050_PWR_MGMT_1		0x6B	// ???????1
#define	MPU6050_PWR_MGMT_2		0x6C	// ???????2
#define	MPU6050_WHO_AM_I		0x75	// ??ID?

#endif


MPU6050.h
#ifndef __MPU6050_H
#define __MPU6050_H

// ???
void MPU6050_Init(void);

// ??????
void MPU6050_Write_Reg(uint8_t Reg_Addr, uint8_t Byte);

// ?????????
int16_t *MPU6050_Read_ALL_Data(void);

// ??????
uint8_t MPU6050_Read_Reg(uint8_t Reg_Addr);

#endif



???
#include "stm32f10x.h"                  // Device header
#include "OLED.h"
#include "MPU6050.h"

int main()
{
	OLED_Init();
	MPU6050_Init();
	
	// ???????
	int16_t *MPU_Data;
	while(1)
	{
		// ?????????
		MPU_Data = MPU6050_Read_ALL_Data();
		
		OLED_ShowSignedNum(1,1,MPU_Data[0],5);
		OLED_ShowSignedNum(2,1,MPU_Data[1],5);
		OLED_ShowSignedNum(3,1,MPU_Data[2],5);
		
		OLED_ShowSignedNum(1,8,MPU_Data[4],5);
		OLED_ShowSignedNum(2,8,MPU_Data[5],5);
		OLED_ShowSignedNum(3,8,MPU_Data[6],5);
		
		OLED_ShowSignedNum(4,3,MPU_Data[3],5);
	}
}
	}
}
